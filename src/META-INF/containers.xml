<?xml version="1.0" encoding="UTF-8"?>
<containers xmlns="http://www.appserver.io/appserver">
    <container name="${container.name}">
        <servers>
            <server name="http*">
                <virtualHosts>
                    <!-- an example for a virtual host configuration -->
                    <virtualHost name="${webapp.name}.dev www.${webapp.name}.dev">
                        <params>
                            <param name="admin" type="string">info@appserver.io</param>
                            <param name="documentRoot" type="string">${host.appBase.dir}/${webapp.name}</param>
                        </params>
                        <rewrites>
                            <rewrite condition="-d{OR}-f{OR}-l" target="" flag="L" />
                        </rewrites>
                        <accesses>
                            <access type="allow">
                                <params>
                                    <param name="X_REQUEST_URI" type="string">^.*</param>
                                </params>
                            </access>
                        </accesses>
                        <!-- an example for basic or digest auth for the server -->
                        <authentications>
                            <authentication uri="^\/dhtml\/basic.dhtml.*">
                                <params>
                                    <param name="type" type="string">\AppserverIo\Http\Authentication\BasicAuthentication</param>
                                    <param name="realm" type="string">PhpWebServer Basic Authentication System</param>
                                    <param name="file" type="string">${host.appBase.dir}/${webapp.name}/WEB-INF/htpasswd</param>
                                </params>
                            </authentication>
                            <authentication uri="^\/dhtml\/digest.dhtml.*">
                                <params>
                                    <param name="type" type="string">\AppserverIo\Http\Authentication\DigestAuthentication</param>
                                    <param name="realm" type="string">Digest-Example-Realm</param>
                                    <param name="adapter-type" type="string">htdigest</param>
                                    <param name="file" type="string">${host.appBase.dir}/${webapp.name}/WEB-INF/htdigest</param>
                                </params>
                            </authentication>
                        </authentications>
                        <!-- an example how to modify response headers -->
                        <headers>
                            <header type="response" name="Server" value="My Own Server" override="true"/>
                            <header type="response" name="X-Powered-By" value="${webapp.name}.dev"/>
                        </headers>
                        <!-- an example to activate the auto index functionality on a custom directory -->
                        <locations>
                            <location condition="^\/static\/.*">
                                <headers>
                                    <header type="response" name="X-Powered-By" value="autoIndex" append="true"/>
                                </headers>
                                <params>
                                    <param name="autoIndex" type="boolean">true</param>
                                </params>
                            </location>
                        </locations>
                        <environmentVariables>
                            <environmentVariable condition="" definition="LOGGER_ACCESS=${container.name}/${webapp.name}/Access" />
                        </environmentVariables>
                    </virtualHost>
                </virtualHosts>
            </server>
        </servers>
    </container>

    <container
            name="${webapp.name}-container"
            type="AppserverIo\SingleApp\Core\SimpleContainer"
            factory="AppserverIo\Appserver\Core\GenericContainerFactory">

        <classLoaders>
            <classLoader
                name="SplClassLoader"
                interface="ClassLoaderInterface"
                type="AppserverIo\Appserver\Core\SplClassLoader"
                factory="AppserverIo\Appserver\Core\SplClassLoaderFactory">
                <directories>
                    <directory>/${webapp.name}/common/classes</directory>
                    <directory>/${webapp.name}/WEB-INF/classes</directory>
                    <directory>/${webapp.name}/META-INF/classes</directory>
                </directories>
            </classLoader>
        </classLoaders>

        <description>
            <![CDATA[This is an example of a webserver container that handles http requests in common way]]>
        </description>

        <deployment type="AppserverIo\SingleApp\Core\SimpleDeployment" />

        <host name="localhost" appBase="webapps" deployBase="deploy" tmpBase="var/tmp/localhost" />

        <servers>

            <server
                    name="${webapp.name}-server"
                    type="\AppserverIo\Apps\Example\Servers\MyServer"
                    worker="\AppserverIo\Server\Workers\ThreadWorker"
                    socket="\AppserverIo\Server\Sockets\StreamSocket"
                    requestContext="\AppserverIo\Server\Contexts\RequestContext"
                    serverContext="\AppserverIo\Appserver\Server\Contexts\StandardServerContext"
                    streamContext="\AppserverIo\Server\Contexts\StreamContext"
                    loggerName="System">
                <params>
                    <param name="admin" type="string">info@appserver.io</param>
                    <param name="transport" type="string">tcp</param>
                    <param name="address" type="string">0.0.0.0</param>
                    <param name="port" type="integer">9081</param>
                    <param name="workerNumber" type="integer">16</param>
                    <param name="workerAcceptMin" type="integer">3</param>
                    <param name="workerAcceptMax" type="integer">8</param>
                    <param name="documentRoot" type="string">webapps</param>
                    <param name="directoryIndex" type="string">index.dhtml index.do index.php index.html index.htm</param>
                    <param name="keepAliveMax" type="integer">64</param>
                    <param name="keepAliveTimeout" type="integer">5</param>
                    <param name="autoIndex" type="boolean">false</param>
                    <param name="errorsPageTemplatePath" type="string">resources/templates/www/error.phtml</param>
                    <param name="welcomePageTemplatePath" type="string">resources/templates/www/welcome.phtml</param>
                    <param name="autoIndexTemplatePath" type="string">resources/templates/www/auto_index.phtml</param>
                </params>

                <environmentVariables>
                    <environmentVariable condition="" definition="LOGGER_ACCESS=Access" />
                </environmentVariables>

                <connectionHandlers>
                    <connectionHandler type="\AppserverIo\WebServer\ConnectionHandlers\HttpConnectionHandler" />
                </connectionHandlers>

                <accesses>
                    <!-- per default allow everything -->
                    <access type="allow">
                        <params>
                            <param name="X_REQUEST_URI" type="string">.*</param>
                        </params>
                    </access>
                </accesses>

                <modules>
                    <!-- REQUEST_POST hook -->
                    <module type="\AppserverIo\WebServer\Modules\VirtualHostModule"/>
                    <module type="\AppserverIo\WebServer\Modules\AuthenticationModule"/>
                    <module type="\AppserverIo\WebServer\Modules\EnvironmentVariableModule" />
                    <module type="\AppserverIo\WebServer\Modules\RewriteModule"/>
                    <module type="\AppserverIo\WebServer\Modules\DirectoryModule"/>
                    <module type="\AppserverIo\WebServer\Modules\AccessModule"/>
                    <module type="\AppserverIo\WebServer\Modules\LocationModule"/>
                    <module type="\AppserverIo\WebServer\Modules\AutoIndexModule"/>
                    <!-- FileHandler Modules -->
                    <module type="\AppserverIo\WebServer\Modules\CoreModule"/>
                    <module type="\AppserverIo\WebServer\Modules\PhpModule"/>
                    <module type="\AppserverIo\WebServer\Modules\FastCgiModule"/>
                    <module type="\AppserverIo\SingleApp\ServletEngine\SimpleServletEngine"/>
                    <module type="\AppserverIo\WebServer\Modules\ProxyModule"/>
                    <!-- RESPONSE_PRE hook -->
                    <module type="\AppserverIo\WebServer\Modules\HeaderModule"/>
                    <module type="\AppserverIo\WebServer\Modules\DeflateModule"/>
                    <!-- RESPONSE_POST hook -->
                    <!-- module type="\AppserverIo\Apps\Example\Modules\MyServerModule"/ -->
                </modules>

                <fileHandlers>
                    <fileHandler name="fastcgi" extension=".php">
                        <params>
                            <param name="host" type="string">127.0.0.1</param>
                            <param name="port" type="integer">9010</param>
                        </params>
                    </fileHandler>
                    <fileHandler name="fastcgi" extension=".phtml">
                        <params>
                            <param name="host" type="string">127.0.0.1</param>
                            <param name="port" type="integer">9010</param>
                        </params>
                    </fileHandler>
                    <fileHandler name="servlet" extension=".dhtml" />
                    <fileHandler name="servlet" extension=".do" />
                </fileHandlers>

            </server>
        </servers>
    </container>
</containers>